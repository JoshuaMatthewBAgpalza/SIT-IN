<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sit-in Reports - CCS Sit-In System</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
   <style>
    :root {
        --primary-color: #0905f7;        /* Bold Red */
        --secondary-color: #f8f404;      /* Darker Red */
        --accent-color: #D11D27;         /* Bright Red */
        --light-color: #f8f9fa;          /* Light background */
        --dark-color: #000000;           /* Pure Black */
        --success-color: #2a9d8f;        /* Teal */
        --warning-color: #e9c46a;        /* Gold */
        --danger-color: #B4121B;         /* Same as primary */
    }

    body {
        font-family: Georgia, serif;
        background: linear-gradient(to right, #0101e9, #d8fd03);
        color: #495057;
        min-height: 100vh;
    }

    .header-banner {
        background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
        color: white;
        padding: 16px 0;
        overflow: hidden;
    }

    .header-banner::after {
        content: '';
        position: absolute;
        bottom: -10px;
        left: 0;
        right: 0;
        height: 20px;
        background: #fff;
        border-radius: 50% 50% 0 0;
    }

    .navbar {
        background: linear-gradient(to right, #0101e9, #d8fd03);
        box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        border-bottom: 2px solid var(--primary-color);
    }

    .navbar .nav-link {
        color: var(--dark-color) !important;
        font-weight: 500;
        padding: 10px 16px !important;
        border-radius: 4px;
        transition: all 0.3s ease;
        font-size: 0.9rem;
        margin: 0 2px;
    }

    .navbar .nav-link:hover {
        background-color: rgba(180, 18, 27, 0.1);
        color: var(--primary-color) !important;
        transform: translateY(-2px);
    }

    .navbar .nav-item.active .nav-link {
        background-color: var(--primary-color);
        color: white !important;
        box-shadow: 0 4px 8px rgba(180, 18, 27, 0.2);
    }
    
    .navbar .navbar-nav {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .navbar-collapse {
        max-height: 80vh;
        overflow-y: auto;
        scrollbar-width: thin;
    }
    
    .navbar-collapse::-webkit-scrollbar {
        width: 6px;
    }
    
    .navbar-collapse::-webkit-scrollbar-thumb {
        background-color: var(--primary-color);
        border-radius: 10px;
    }
    
    .badge-pill.badge-danger {
        position: relative;
        top: -5px;
        margin-left: 3px;
        font-size: 0.7rem;
        padding: 3px 6px;
        box-shadow: 0 2px 5px rgba(180, 18, 27, 0.3);
        background-color: var(--danger-color);
    }

    .card {
        border: none;
        border-radius: 15px;
        box-shadow: 0 5px 25px rgba(0,0,0,0.05);
        transition: all 0.3s ease;
        margin-bottom: 25px;
        overflow: hidden;
        border-top: 3px solid var(--primary-color);
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(0,0,0,0.1);
    }

    .card-header {
        background: var(--dark-color);
        color: white;
        font-weight: 600;
        padding: 18px 20px;
        border-bottom: none;
        border-radius: 15px 15px 0 0 !important;
        border-bottom: 1px solid var(--primary-color);
    }

    .card-body {
        padding: 25px;
    }

    .btn {
        border-radius: 8px;
        padding: 10px 20px;
        font-weight: 500;
        letter-spacing: 0.5px;
        transition: all 0.3s ease;
        color: white;
    }

    .btn-primary {
        background: var(--primary-color);
        border: none;
    }

    .btn-primary:hover {
        background: var(--secondary-color);
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(180, 18, 27, 0.3);
    }

    .btn-success {
        background: var(--success-color);
        border: none;
    }

    .btn-success:hover {
        background: #24a08c;
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(42, 157, 143, 0.3);
    }

    .btn-danger {
        background: var(--danger-color);
        border: none;
    }

    .btn-danger:hover {
        background: var(--secondary-color);
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(180, 18, 27, 0.3);
    }

    .btn-sm {
        padding: 6px 12px;
        font-size: 0.85rem;
    }

    .table {
        background-color: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    }

    .table thead th {
        background-color: var(--dark-color);
        color: white;
        border: none;
        font-weight: 500;
        padding: 12px 15px;
        border-bottom: 2px solid var(--primary-color);
    }

    .table td {
        padding: 12px 15px;
        vertical-align: middle;
        border-color: #f0f0f0;
    }

    .table tbody tr:hover {
        background-color: rgba(180, 18, 27, 0.05);
    }

    .badge {
        padding: 6px 10px;
        font-weight: 500;
        border-radius: 8px;
        color: white;
    }

    .badge-success {
        background-color: var(--success-color);
    }

    .badge-warning {
        background-color: var(--warning-color);
        color: var(--dark-color);
    }

    .badge-danger {
        background-color: var(--danger-color);
    }

    .modal-content {
        border-radius: 15px;
        border: none;
        overflow: hidden;
        border-top: 3px solid var(--primary-color);
    }

    .modal-header {
        background: var(--dark-color);
        color: white;
        border-bottom: 1px solid var(--primary-color);
    }

    .modal-header .close {
        color: white;
        opacity: 0.8;
    }

    .modal-header .close:hover {
        opacity: 1;
        color: var(--primary-color);
    }

    .modal-footer {
        border-top: none;
    }

    .form-control {
        border-radius: 8px;
        border: 1px solid #e1e1e1;
        padding: 12px 15px;
        font-size: 0.95rem;
        transition: all 0.3s ease;
        background-color: #f8f9fa;
        margin-bottom: 15px;
    }

    .form-control:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(180, 18, 27, 0.25);
        background-color: #fff;
    }

    .filter-bar {
        background-color: white;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 20px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        border-top: 3px solid var(--primary-color);
    }

    .page-item.active .page-link {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
    }

    .page-link {
        color: var(--primary-color);
    }

    .page-link:hover {
        color: var(--secondary-color);
    }

    .chart-container {
        position: relative;
        height: 300px;
        margin-bottom: 20px;
    }

    @media print {
        .no-print {
            display: none;
        }
        .navbar, .header-banner {
            display: none;
        }
        .card {
            box-shadow: none;
            border: 1px solid #ddd;
            border-top: 3px solid var(--primary-color);
        }
        .table {
            width: 100%;
            box-shadow: none;
            border: 1px solid #ddd;
        }
        .print-header h1 {
            color: var(--primary-color);
        }
    }
</style>
</head>

<body>
    <!-- Header Banner -->
    <div class="header-banner">
        <div class="container text-center">
            <h3 class="font-weight-bold mb-0">CCS ADMIN</h3>
        </div>
    </div>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light sticky-top">
        <div class="container">
            <a class="navbar-brand d-lg-none" href="{{ url_for('admin_dashboard') }}">
                <i class="fas fa-university mr-1"></i> CCS Admin
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('admin_dashboard') }}">
                            <i class="fas fa-home mr-1"></i> Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-toggle="modal" data-target="#searchModal">
                            <i class="fas fa-search mr-1"></i> Search
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('view_students') }}">
                            <i class="fas fa-user-graduate mr-1"></i> Student
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('sitin_page') }}">
                            <i class="fas fa-chair mr-1"></i> Sit-in
                            {% if active_count > 0 %}
                                <span class="badge badge-pill badge-danger">{{ active_count }}</span>
                            {% endif %}
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('current_sitins') }}">
                            <i class="fas fa-clipboard-list mr-1"></i> Records
                        </a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="{{ url_for('sitin_report') }}">
                            <i class="fas fa-chart-bar mr-1"></i> Reports
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('feedback_report') }}">
                            <i class="fas fa-comment-alt mr-1"></i> Feedback
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('lab_usage_points') }}">
                            <i class="fas fa-award mr-1"></i> Points
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('leaderboard') }}">
                            <i class="fas fa-trophy mr-1"></i> Leaderboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('admin_reservation') }}">
                            <i class="fas fa-calendar-alt mr-1"></i> Reservations
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('computer_control') }}">
                            <i class="fas fa-desktop mr-1"></i> Computers
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-danger" href="{{ url_for('logout') }}">
                            <i class="fas fa-sign-out-alt mr-1"></i> Logout
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Search Modal -->
    <div class="modal fade" id="searchModal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="searchModalLabel">Search Student</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="searchInput"><i class="fas fa-id-card mr-1"></i> Student ID</label>
                        <input type="text" class="form-control" id="searchInput" placeholder="Enter student ID">
                    </div>
                    <button class="btn btn-primary" id="searchStudentBtn">
                        <i class="fas fa-search mr-1"></i> Search
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container py-5">
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header d-flex align-items-center justify-content-between">
                        <div>
                            <i class="fas fa-chart-pie mr-2"></i> Sit-In Analytics
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="chart-container">
                                    <canvas id="labChart"></canvas>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="chart-container">
                                    <canvas id="purposeChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header d-flex align-items-center justify-content-between">
                        <div>
                            <i class="fas fa-list mr-2"></i> Sit-In Records
                        </div>
                        <div>
                            <button id="csvBtn" class="btn btn-sm btn-success mr-1"><i class="fas fa-file-csv mr-1"></i> CSV</button>
                            <button id="excelBtn" class="btn btn-sm btn-primary mr-1"><i class="fas fa-file-excel mr-1"></i> Excel</button>
                            <button id="pdfBtn" class="btn btn-sm btn-danger mr-1"><i class="fas fa-file-pdf mr-1"></i> PDF</button>
                            <button id="printBtn" class="btn btn-sm btn-info"><i class="fas fa-print mr-1"></i> Print</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="filter-bar d-flex justify-content-between align-items-center mb-4">
                            <div class="d-flex align-items-center">
                                <div class="mr-3">
                                    <label for="dateFilter" class="mb-0 mr-2">Date:</label>
                                    <input type="date" id="dateFilter" class="form-control form-control-sm">
                                </div>
                                <div>
                                    <label for="statusFilter" class="mb-0 mr-2">Status:</label>
                                    <select id="statusFilter" class="form-control form-control-sm">
                                        <option value="all">All</option>
                                        <option value="completed">Completed</option>
                                        <option value="active">Active</option>
                                    </select>
                                </div>
                            </div>
                            <div class="position-relative">
                                <input type="text" id="tableSearch" class="form-control form-control-sm" placeholder="Search...">
                                <i class="fas fa-search position-absolute" style="right: 10px; top: 10px; color: #777;"></i>
                            </div>
                        </div>
                        
                        <div class="table-responsive">
                            <table class="table table-hover" id="sitinTable">
                                <thead>
                                    <tr>
                                        <th><i class="fas fa-id-card mr-1"></i> ID Number</th>
                                        <th><i class="fas fa-user mr-1"></i> Name</th>
                                        <th><i class="fas fa-tasks mr-1"></i> Purpose</th>
                                        <th><i class="fas fa-laptop-house mr-1"></i> Laboratory</th>
                                        <th><i class="fas fa-sign-in-alt mr-1"></i> Login</th>
                                        <th><i class="fas fa-sign-out-alt mr-1"></i> Logout</th>
                                        <th><i class="fas fa-info-circle mr-1"></i> Status</th>
                                        <th><i class="fas fa-calendar-alt mr-1"></i> Date</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if sitins %}
                                        {% for sitin in sitins %}
                                            <tr>
                                                <td>{{ sitin.student_id }}</td>
                                                <td>{{ sitin.firstname }} {{ sitin.lastname }}</td>
                                                <td>{{ sitin.purpose }}</td>
                                                <td>{{ sitin.lab_number }}</td>
                                                <td>{{ sitin.login_time if sitin.login_time else 'N/A' }}</td>
                                                <td>{{ sitin.logout_time if sitin.logout_time else 'N/A' }}</td>
                                                <td>
                                                    {% if sitin.logout_time %}
                                                        <span class="badge badge-success">Completed</span>
                                                    {% else %}
                                                        <span class="badge badge-warning">Active</span>
                                                    {% endif %}
                                                </td>
                                                <td>{{ sitin.timestamp.split(' ')[0] if ' ' in sitin.timestamp else sitin.timestamp }}</td>
                                            </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="8" class="text-center py-4">
                                                <i class="fas fa-info-circle fa-2x mb-3 text-muted"></i>
                                                <p class="mb-0 text-muted">No sit-in records available</p>
                                            </td>
                                        </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                        
                        {% if sitins and sitins|length > 10 %}
                        <div class="d-flex justify-content-between align-items-center mt-4">
                            <div>
                                <p class="text-muted mb-0">Showing 1 to {{ sitins|length if sitins|length < 10 else 10 }} of {{ sitins|length }} entries</p>
                            </div>
                            <nav>
                                <ul class="pagination pagination-sm mb-0" id="pagination">
                                    <!-- Pagination will be generated by JavaScript -->
                                </ul>
                            </nav>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.4/jspdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.6/jspdf.plugin.autotable.min.js"></script>

    <script>
   $(document).ready(function () {
    // Search filter
    $("#tableSearch").on("keyup", function () {
        const value = $(this).val().toLowerCase();
        $("#sitinTable tbody tr").filter(function () {
            $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
        });
        updatePagination();
    });

    // Date filter
    $("#dateFilter").on("change", function () {
        const date = $(this).val();
        if (date) {
            $("#sitinTable tbody tr").hide().filter(function () {
                return $(this).find("td:last-child").text().trim().includes(date);
            }).show();
        } else {
            $("#sitinTable tbody tr").show();
        }
        updatePagination();
    });

    // Status filter
    $("#statusFilter").on("change", function () {
        const status = $(this).val().toLowerCase();
        if (status === "all") {
            $("#sitinTable tbody tr").show();
        } else {
            $("#sitinTable tbody tr").hide().filter(function () {
                return $(this).find("td:nth-child(7)").text().toLowerCase().includes(status);
            }).show();
        }
        updatePagination();
    });

    // Pagination event delegated binding
    const rowsPerPage = 10;
    $("#pagination").on("click", ".page-link", function (e) {
        e.preventDefault();
        const page = $(this).data("page");
        if (page) {
            showPage(page, rowsPerPage);
            $(".page-item").removeClass("active");
            $(this).parent().addClass("active");
        }
    });

    updatePagination();

    // ... other event handlers and initCharts() remain unchanged
});

function updatePagination() {
    const rowsPerPage = 10;
    const rows = $("#sitinTable tbody tr:visible");
    const totalPages = Math.ceil(rows.length / rowsPerPage);

    if (rows.length === 0) {
        $("#pagination").empty();
        return;
    }

    let paginationHtml = '';

    if (rows.length > rowsPerPage) {
        paginationHtml += `<li class="page-item disabled"><a class="page-link" href="#"><i class="fas fa-chevron-left"></i></a></li>`;
        for (let i = 1; i <= totalPages; i++) {
            paginationHtml += `<li class="page-item ${i === 1 ? 'active' : ''}">
                <a class="page-link" href="#" data-page="${i}">${i}</a></li>`;
        }
        paginationHtml += `<li class="page-item"><a class="page-link" href="#"><i class="fas fa-chevron-right"></i></a></li>`;
        $("#pagination").html(paginationHtml);

        showPage(1, rowsPerPage);
    } else {
        $("#pagination").empty();
        rows.show();
    }
}

function showPage(page, rowsPerPage) {
    const allRows = $("#sitinTable tbody tr:visible");
    allRows.hide();
    allRows.slice((page - 1) * rowsPerPage, page * rowsPerPage).show();
}

</script>
</body>
</html> 