<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>College of Computer Studies Admin</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}">
    <style>
    :root {
        --primary-color: #B4121B;
        --secondary-color: #8C0D14;
        --accent-color: #D43A43;
        --light-color: #f8f9fa;
        --dark-color: #000000;
        --success-color: #2bc4a9;
        --warning-color: #f9c74f;
        --danger-color: #B4121B;
    }

    body {
        font-family: 'Poppins', sans-serif;
        background-color: #f5f7fa;
        color: #495057;
        min-height: 100vh;
    }

    .header-banner {
        background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
        color: white;
        padding: 16px 0;
        position: relative;
        overflow: hidden;
    }

    .header-banner::after {
        content: '';
        position: absolute;
        bottom: -10px;
        left: 0;
        right: 0;
        height: 20px;
        background: #fff;
        border-radius: 50% 50% 0 0;
    }

    .navbar {
        background-color: #fff !important;
        box-shadow: 0 2px 15px rgba(0,0,0,0.1);
    }

    .navbar .nav-link {
        color: var(--dark-color) !important;
        font-weight: 500;
        padding: 10px 16px !important;
        border-radius: 4px;
        transition: all 0.3s ease;
        font-size: 0.9rem;
        margin: 0 2px;
    }

    .navbar .nav-link:hover {
        background-color: rgba(180, 18, 27, 0.1);
        color: var(--primary-color) !important;
        transform: translateY(-2px);
    }

    .navbar .nav-item.active .nav-link {
        background-color: var(--primary-color);
        color: white !important;
        box-shadow: 0 4px 8px rgba(180, 18, 27, 0.2);
    }
    
    .navbar .navbar-nav {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .navbar-collapse {
        max-height: 80vh;
        overflow-y: auto;
        scrollbar-width: thin;
    }
    
    .navbar-collapse::-webkit-scrollbar {
        width: 6px;
    }
    
    .navbar-collapse::-webkit-scrollbar-thumb {
        background-color: var(--primary-color);
        border-radius: 10px;
    }
    
    .badge-pill.badge-danger {
        position: relative;
        top: -5px;
        margin-left: 3px;
        font-size: 0.7rem;
        padding: 3px 6px;
        box-shadow: 0 2px 5px rgba(180, 18, 27, 0.3);
    }

    .card {
        border: none;
        border-radius: 15px;
        box-shadow: 0 5px 25px rgba(0,0,0,0.05);
        transition: all 0.3s ease;
        margin-bottom: 25px;
        overflow: hidden;
        border-top: 4px solid var(--primary-color);
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(0,0,0,0.1);
    }

    .card-header {
        background: var(--dark-color);
        color: white;
        font-weight: 600;
        padding: 18px 20px;
        border-bottom: 2px solid var(--primary-color) !important;
        border-radius: 0 !important;
    }

    .card-header.bg-success {
        background: var(--success-color) !important;
        border-bottom: 2px solid #1e9c86 !important;
    }

    .card-header.bg-primary {
        background: var(--primary-color) !important;
        border-bottom: 2px solid var(--secondary-color) !important;
    }

    .card-body {
        padding: 25px;
    }

    .form-control {
        border-radius: 8px;
        border: 1px solid #e1e1e1;
        padding: 12px 15px;
        font-size: 0.95rem;
        transition: all 0.3s ease;
        background-color: #f8f9fa;
        margin-bottom: 15px;
    }

    .form-control:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(180, 18, 27, 0.25);
        background-color: #fff;
    }

    .btn {
        border-radius: 8px;
        padding: 10px 20px;
        font-weight: 500;
        letter-spacing: 0.5px;
        transition: all 0.3s ease;
    }

    .btn-primary {
        background: var(--primary-color);
        border: none;
    }

    .btn-primary:hover {
        background: var(--secondary-color);
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(180, 18, 27, 0.3);
    }

    .btn-success {
        background: var(--success-color);
        border: none;
    }

    .btn-success:hover {
        background: #24a08c;
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(43, 196, 169, 0.3);
    }

    .btn-danger {
        background: var(--danger-color);
        border: none;
    }

    .btn-danger:hover {
        background: var(--secondary-color);
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(180, 18, 27, 0.3);
    }

    .text-muted {
        color: #6c757d !important;
    }

    .stat-card {
        padding: 20px;
        text-align: center;
        border-radius: 10px;
        background: white;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        margin-bottom: 20px;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        border-top: 3px solid var(--primary-color);
    }

    .stat-card h4 {
        font-size: 1.8rem;
        font-weight: 600;
        margin-bottom: 5px;
        color: var(--primary-color);
    }

    .stat-card .icon {
        font-size: 2.5rem;
        margin-bottom: 10px;
        color: var(--primary-color);
    }

    .stat-card p {
        color: #6c757d;
        margin-bottom: 0;
        font-weight: 500;
    }

    .modal-content {
        border-radius: 15px;
        border: none;
        overflow: hidden;
        border-top: 4px solid var(--primary-color);
    }

    .modal-header {
        background: var(--dark-color);
        color: white;
        border-bottom: 2px solid var(--primary-color);
    }

    .modal-header .close {
        color: white;
        opacity: 0.8;
    }

    .modal-header .close:hover {
        opacity: 1;
    }

    .modal-footer {
        border-top: none;
    }

    .announcement-card {
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        margin-bottom: 15px;
        padding: 15px;
        transition: all 0.3s ease;
        border-left: 3px solid var(--primary-color);
    }

    .announcement-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }

    .announcement-card h6 {
        color: var(--primary-color);
        font-weight: 600;
        margin-bottom: 8px;
    }

    .announcement-card p {
        color: #495057;
        margin-bottom: 8px;
    }

    .announcement-card small {
        color: #6c757d;
        font-size: 12px;
    }
</style>
</head>
<body>
    <!-- Header Banner -->
    <div class="header-banner">
        <div class="container text-center">
            <h3 class="font-weight-bold mb-0">College of Computer Studies Admin</h3>
        </div>
    </div>

    <!-- Include Admin Navbar -->
    {% include 'admin_navbar.html' %}

    <!-- Add this after the navbar -->
    <div class="container mt-3">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    {% include 'search_modal.html' %}

<!-- Sit In Modal -->
<div class="modal fade" id="sitInModal" tabindex="-1" role="dialog" aria-labelledby="sitInModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #4361ee; color: white; padding: 20px;">
                <h5 class="modal-title" id="sitInModalLabel" style="font-size: 1.5rem; font-weight: 700;">
                    <i class="fas fa-chair mr-2"></i> Sit In Form
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color: white; opacity: 1;">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="padding: 30px;">
                <form id="sitInForm">
                    <!-- Student Information Section -->
                    <h5 class="mb-4" style="font-size: 1.3rem; font-weight: 600; border-bottom: 2px solid #4361ee; padding-bottom: 10px; color: #4361ee;">
                        <i class="fas fa-user mr-2"></i> Student Information
                    </h5>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="idNumber" style="font-size: 1.2rem; font-weight: 600; color: #333; margin-bottom: 12px;">
                                    <i class="fas fa-id-card mr-2"></i> ID Number
                                </label>
                                <input type="text" class="form-control form-control-lg" id="idNumber" readonly 
                                    style="font-size: 1.1rem; padding: 12px 15px; font-weight: 500; background-color: #f8f9fa; border: 2px solid #e1e1e1;">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="studentName" style="font-size: 1.2rem; font-weight: 600; color: #333; margin-bottom: 12px;">
                                    <i class="fas fa-user mr-2"></i> Student Name
                                </label>
                                <input type="text" class="form-control form-control-lg" id="studentName" readonly
                                    style="font-size: 1.1rem; padding: 12px 15px; font-weight: 500; background-color: #f8f9fa; border: 2px solid #e1e1e1;">
                            </div>
                        </div>
                    </div>
                    
                    <hr class="my-4" style="border-top: 1px solid #e1e1e1;">
                    
                    <!-- Sit-In Details Section -->
                    <h5 class="mb-4" style="font-size: 1.3rem; font-weight: 600; border-bottom: 2px solid #4361ee; padding-bottom: 10px; color: #4361ee;">
                        <i class="fas fa-info-circle mr-2"></i> Sit-In Details
                    </h5>
                    <div class="form-group">
                        <label for="purpose" style="font-size: 1.2rem; font-weight: 600; color: #333; margin-bottom: 12px;">
                            <i class="fas fa-tasks mr-2"></i> Purpose
                        </label>
                        <select class="form-control form-control-lg" id="purpose" 
                            style="font-size: 1.1rem; padding: 12px 15px; font-weight: 500; border: 2px solid #4361ee;">
                            <optgroup label="Programming Languages">
                                <option value="C Programming">C Programming</option>
                                <option value="C# Programming">C# Programming</option>
                                <option value="C++ Programming">C++ Programming</option>
                                <option value="Java Programming">Java Programming</option>
                                <option value="Python Programming">Python Programming</option>
                                <option value="PHP Programming">PHP Programming</option>
                                <option value=".NET Programming">.NET Programming</option>
                            </optgroup>
                            <optgroup label="Courses">
                                <option value="Digital Logic $ Design">Digital Logic & Design</option>
                                <option value="System Integration & Architecture">System Integration & Architecture</option>
                                <option value="Computer Application">Computer Application</option>
                                <option value="Project Management">Project Management</option>	
                                <option value="IT Trends">IT Trends</option>	
                                <option value="Technopreneurship">Technopreneurship</option>	
                                <option value="Capstone">Capstone</option>	
                            </optgroup>
                        </select>
                        <small class="text-muted" style="font-size: 0.9rem; margin-top: 8px; display: block;">
                            Select the purpose of this sit-in session
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="lab" style="font-size: 1.2rem; font-weight: 600; color: #333; margin-bottom: 12px;">
                            <i class="fas fa-door-open mr-2"></i> Laboratory
                        </label>
                        <select class="form-control form-control-lg" id="lab"
                            style="font-size: 1.1rem; padding: 12px 15px; font-weight: 500; border: 2px solid #4361ee;">
                            <option value="524">Laboratory 524</option>
                            <option value="526">Laboratory 526</option>
                            <option value="528">Laboratory 528</option>
                            <option value="530">Laboratory 530</option>
                            <option value="542">Laboratory 542</option>
                            <option value="544">Laboratory 544</option>
                            <option value="517">Laboratory 517</option>
                        </select>
                        <small class="text-muted" style="font-size: 0.9rem; margin-top: 8px; display: block;">
                            Select the laboratory for this sit-in session
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="remainingSession" style="font-size: 1.2rem; font-weight: 600; color: #333; margin-bottom: 12px;">
                            <i class="fas fa-clock mr-2"></i> Remaining Session
                        </label>
                        <div class="input-group">
                            <input type="text" class="form-control form-control-lg" id="remainingSession" value="25" readonly
                                style="font-size: 1.1rem; padding: 12px 15px; font-weight: 500; background-color: #f8f9fa; border: 2px solid #e1e1e1;">
                            <div class="input-group-append">
                                <span class="input-group-text" style="background-color: #f8f9fa; border: 2px solid #e1e1e1; border-left: none;">
                                    <i class="fas fa-history" style="color: #4361ee;"></i>
                                </span>
                            </div>
                        </div>
                        <small class="text-muted" style="font-size: 0.9rem; margin-top: 8px; display: block;">
                            Number of remaining sessions for this student
                        </small>
                    </div>
                    <div class="text-right mt-4">
                        <button type="button" class="btn btn-secondary btn-lg mr-2" data-dismiss="modal" 
                            style="font-size: 1.1rem; font-weight: 600; padding: 12px 25px;">
                            <i class="fas fa-times mr-2"></i> Close
                        </button>
                        <button type="submit" class="btn btn-primary btn-lg" 
                            style="font-size: 1.1rem; font-weight: 600; padding: 12px 25px;">
                            <i class="fas fa-check mr-2"></i> Confirm Sit-In
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="container py-5">
    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header d-flex align-items-center">
                    <i class="fas fa-chart-pie mr-2"></i> Statistics
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="stat-card">
                                <i class="fas fa-users icon"></i>
                                <h4>{{ students_count }}</h4>
                                <p>Total Students</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-card">
                                <i class="fas fa-chair icon"></i>
                                <h4>{{ active_sitin_count }}</h4>
                                <p>Active Sit-ins</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-card">
                                <i class="fas fa-history icon"></i>
                                <h4>{{ total_sitin_count }}</h4>
                                <p>Total Sit-ins</p>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4">
                        <canvas id="purposeChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header d-flex align-items-center">
                    <i class="fas fa-bullhorn mr-2"></i> Announcements
                </div>
                <div class="card-body">
                    <form id="announcementForm">
                        <div class="form-group">
                            <label for="announcementTitle"><i class="fas fa-heading mr-1"></i> Title</label>
                            <input type="text" class="form-control" id="announcementTitle" placeholder="Announcement Title" required>
                        </div>
                        <div class="form-group">
                            <label for="announcementContent"><i class="fas fa-align-left mr-1"></i> Content</label>
                            <textarea class="form-control" id="announcementContent" rows="3" placeholder="Announcement Content" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-paper-plane mr-1"></i> Post Announcement
                        </button>
                    </form>
                    <hr>
                    <div id="announcementsContainer">
                        {% if announcements %}
                            {% for announcement in announcements %}
                                <div class="announcement-card">
                                    <h6>{{ announcement[1] }}</h6>
                                    <p>{{ announcement[2] }}</p>
                                    <small>
                                        <i class="fas fa-user mr-1"></i> {{ announcement.created_by }}
                                        <i class="fas fa-calendar-alt ml-2 mr-1"></i> {{ announcement.created_at }}
                                    </small>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="text-center py-4">
                                <i class="fas fa-inbox fa-3x mb-3 text-muted"></i>
                                <p class="text-muted">No announcements available at this time.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // Function to handle search form submission
    $("#searchStudentBtn").click(function() {
        const studentId = $("#searchInput").val().trim();
        if (studentId === "") {
            alert("Please enter a student ID");
            return;
        }
        
        // Search for the student and open sit-in form
        $.ajax({
            url: "/search_student",
            type: "GET",
            data: { idno: studentId },
            success: function(response) {
                // Populate sit-in form with student details
                $("#idNumber").val(response.idno);
                $("#studentName").val(response.firstname + " " + response.lastname);
                
                // Get remaining sessions
                $.ajax({
                    url: "/get_user_sessions/" + response.idno,
                    type: "GET",
                    success: function(sessionsData) {
                        $("#remainingSession").val(sessionsData.user.remaining_sessions);
                        // Open the sit-in modal
                        $("#sitInModal").modal("show");
                    },
                    error: function(xhr) {
                        let errorMsg = "Error getting remaining sessions.";
                        if (xhr.responseJSON && xhr.responseJSON.error) {
                            errorMsg = xhr.responseJSON.error;
                        }
                        alert(errorMsg);
                    }
                });
            },
            error: function(xhr) {
                let errorMsg = "Student not found.";
                if (xhr.responseJSON && xhr.responseJSON.error) {
                    errorMsg = xhr.responseJSON.error;
                }
                alert(errorMsg);
            }
        });
    });
    
    // Handle sit-in form submission
    $("#sitInForm").submit(function(e) {
        e.preventDefault();
        
        const studentId = $("#idNumber").val();
        const purpose = $("#purpose").val();
        const lab = $("#lab").val();
        const remainingSessions = parseInt($("#remainingSession").val());

        if (remainingSessions <= 0) {
            alert("Student has no remaining sessions.");
            return;
        }
        
        // Submit sit-in request to API
        $.ajax({
            url: "/submit_sitin",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify({
                student_id: studentId,
                purpose: purpose,
                lab_number: lab
            }),
            success: function(response) {
                alert("Sit-in recorded successfully!");
                $("#sitInModal").modal("hide");
                // Reload the page to refresh stats
                location.reload();
            },
            error: function(xhr) {
                let errorMsg = "Error recording sit-in.";
                if (xhr.responseJSON && xhr.responseJSON.error) {
                    errorMsg = xhr.responseJSON.error;
                }
                alert(errorMsg);
            }
        });
    });
    
    // Handle announcement form submission
    $("#announcementForm").submit(function(e) {
        e.preventDefault();
        
        const title = $("#announcementTitle").val().trim();
        const content = $("#announcementContent").val().trim();
        
        if (!title || !content) {
            alert("Please enter both title and content for the announcement.");
            return;
        }
        
        // Submit announcement to API
        $.ajax({
            url: "/add_announcement",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify({
                title: title,
                content: content
            }),
            success: function(response) {
                // Add new announcement to the UI
                const newDate = new Date().toLocaleString();
                const adminName = "Admin"; // This should come from the server
                
                const newAnnouncement = `
                    <div class="announcement-card">
                        <h6>${title}</h6>
                        <p>${content}</p>
                        <small><i class="fas fa-user mr-1"></i> ${adminName} <i class="fas fa-calendar-alt ml-2 mr-1"></i> ${newDate}</small>
                    </div>
                `;
                
                // Remove "no announcements" message if it exists
                if ($("#announcementsContainer .text-center").length) {
                    $("#announcementsContainer").empty();
                }
                
                // Add the new announcement at the top
                $("#announcementsContainer").prepend(newAnnouncement);
                
                // Clear the form
                $("#announcementTitle").val('');
                $("#announcementContent").val('');
                
                alert("Announcement posted successfully!");
            },
            error: function() {
                alert("Error posting announcement. Please try again.");
            }
        });
    });
    
    // Purpose distribution chart
    const purposeCtx = document.getElementById('purposeChart').getContext('2d');
    const purposeChart = new Chart(purposeCtx, {
        type: 'bar',
        data: {
            labels: ['C', 'C#', 'C++', 'Java', 'Python', 'PHP'],
            datasets: [{
                label: 'Sit-in by Purpose',
                data: [12, 19, 8, 15, 10, 5],
                backgroundColor: [
                    'rgba(67, 97, 238, 0.7)',
                    'rgba(58, 12, 163, 0.7)',
                    'rgba(76, 201, 240, 0.7)',
                    'rgba(43, 196, 169, 0.7)',
                    'rgba(239, 71, 111, 0.7)',
                    'rgba(249, 199, 79, 0.7)'
                ],
                borderColor: [
                    'rgba(67, 97, 238, 1)',
                    'rgba(58, 12, 163, 1)',
                    'rgba(76, 201, 240, 1)',
                    'rgba(43, 196, 169, 1)',
                    'rgba(239, 71, 111, 1)',
                    'rgba(249, 199, 79, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            },
            responsive: true,
            plugins: {
                legend: {
                    display: false
                },
                title: {
                    display: true,
                    text: 'Sit-in Distribution by Purpose',
                    font: {
                        family: 'Poppins',
                        size: 16,
                        weight: 'bold'
                    }
                }
            }
        }
    });

    // Display file name when selected for resource upload
    $('.custom-file-input').on('change', function() {
        var fileName = $(this).val().split('\\').pop();
        $(this).next('.custom-file-label').html(fileName);
    });

    // Toggle between file upload and link input based on resource type selection
    $('input[name="resourceType"]').on('change', function() {
        var type = $(this).val();
        if (type === 'file') {
            $('#fileUploadGroup').show();
            $('#linkInputGroup').hide();
            $('#resourceFile').prop('required', true);
            $('#resourceLink').prop('required', false);
        } else {
            $('#fileUploadGroup').hide();
            $('#linkInputGroup').show();
            $('#resourceFile').prop('required', false);
            $('#resourceLink').prop('required', true);
        }
    });

    // Lab Schedule History functionality
    $(document).ready(function() {
        // Load schedules when the history tab is clicked
        $('#schedule-history-tab').on('click', function() {
            loadLabSchedules();
        });

        // Handle edit schedule button click
        $(document).on('click', '.edit-schedule-btn', function() {
            const scheduleId = $(this).data('id');
            const laboratory = $(this).data('laboratory');
            const day = $(this).data('day');
            const course = $(this).data('course');
            const instructor = $(this).data('instructor');
            const startTime = $(this).data('start-time');
            const endTime = $(this).data('end-time');
            
            // Populate edit form
            $('#edit_schedule_id').val(scheduleId);
            $('#edit_laboratory').val(laboratory);
            $('#edit_day').val(day);
            $('#edit_course').val(course);
            $('#edit_instructor').val(instructor);
            $('#edit_startTime').val(startTime);
            $('#edit_endTime').val(endTime);
            
            // Show edit modal
            $('#editScheduleModal').modal('show');
        });

        // Handle delete schedule button click
        $(document).on('click', '.delete-schedule-btn', function() {
            const scheduleId = $(this).data('id');
            const laboratory = $(this).data('laboratory');
            const day = $(this).data('day');
            const course = $(this).data('course');
            const startTime = $(this).data('start-time');
            const endTime = $(this).data('end-time');
            
            // Populate delete confirmation
            $('#delete_schedule_id').val(scheduleId);
            $('#delete_laboratory').text('Laboratory ' + laboratory);
            $('#delete_day').text(day);
            $('#delete_course').text(course);
            $('#delete_time').text(startTime + ' - ' + endTime);
            
            // Show delete modal
            $('#deleteScheduleModal').modal('show');
        });
    });

    // Function to load lab schedules
    function loadLabSchedules() {
        $.ajax({
            url: '/get_lab_schedules',
            type: 'GET',
            success: function(schedules) {
                if (schedules.length > 0) {
                    // Hide empty message and show table
                    $('#scheduleHistoryEmpty').hide();
                    
                    // Clear existing rows
                    $('#scheduleHistoryTable tbody').empty();
                    
                    // Add each schedule to the table
                    schedules.forEach(function(schedule) {
                        let row = `
                            <tr>
                                <td>Laboratory ${schedule.laboratory}</td>
                                <td>${schedule.day}</td>
                                <td>${schedule.course}</td>
                                <td>${schedule.instructor}</td>
                                <td>${schedule.start_time} - ${schedule.end_time}</td>
                                <td>${schedule.created_at}</td>
                                <td>
                                    <button class="btn btn-sm btn-primary edit-schedule-btn"
                                        data-id="${schedule.id}"
                                        data-laboratory="${schedule.laboratory}"
                                        data-day="${schedule.day}"
                                        data-course="${schedule.course}"
                                        data-instructor="${schedule.instructor}"
                                        data-start-time="${schedule.start_time}"
                                        data-end-time="${schedule.end_time}">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="btn btn-sm btn-danger delete-schedule-btn ml-1"
                                        data-id="${schedule.id}"
                                        data-laboratory="${schedule.laboratory}"
                                        data-day="${schedule.day}"
                                        data-course="${schedule.course}"
                                        data-start-time="${schedule.start_time}"
                                        data-end-time="${schedule.end_time}">
                                        <i class="fas fa-trash-alt"></i> Delete
                                    </button>
                                </td>
                            </tr>
                        `;
                        $('#scheduleHistoryTable tbody').append(row);
                    });
                } else {
                    // Show empty message and hide table
                    $('#scheduleHistoryEmpty').show();
                }
            },
            error: function(xhr) {
                console.error('Error loading lab schedules:', xhr);
                // Show error message
                $('#scheduleHistoryTable tbody').html('<tr><td colspan="7" class="text-center text-danger">Error loading schedules</td></tr>');
            }
        });
    }
</script>

<!-- Upload Lab Schedule Modal -->
<div class="modal fade" id="uploadLabScheduleModal" tabindex="-1" role="dialog" aria-labelledby="uploadLabScheduleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #4361ee; color: white; padding: 20px;">
                <h5 class="modal-title" id="uploadLabScheduleModalLabel" style="font-size: 1.5rem; font-weight: 700;">
                    <i class="fas fa-calendar-plus mr-2"></i> Upload Lab Schedule
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color: white; opacity: 1;">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="padding: 30px;">
                <ul class="nav nav-tabs mb-4" id="scheduleModalTabs" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="new-schedule-tab" data-toggle="tab" href="#new-schedule" role="tab" aria-controls="new-schedule" aria-selected="true">
                            <i class="fas fa-plus-circle mr-2"></i> New Schedule
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="schedule-history-tab" data-toggle="tab" href="#schedule-history" role="tab" aria-controls="schedule-history" aria-selected="false">
                            <i class="fas fa-history mr-2"></i> Schedule History
                        </a>
                    </li>
                </ul>
                
                <div class="tab-content" id="scheduleModalTabContent">
                    <!-- New Schedule Form Tab -->
                    <div class="tab-pane fade show active" id="new-schedule" role="tabpanel" aria-labelledby="new-schedule-tab">
                <form id="labScheduleForm" action="{{ url_for('upload_lab_schedule') }}" method="POST">
                    <div class="form-group">
                        <label for="laboratory" style="font-size: 1.2rem; font-weight: 600; color: #333; margin-bottom: 12px;">
                            <i class="fas fa-door-open mr-2"></i> Laboratory
                        </label>
                        <select class="form-control form-control-lg" id="laboratory" name="laboratory" required
                            style="font-size: 1.1rem; padding: 12px 15px; font-weight: 500; border: 2px solid #4361ee;">
                            <option value="" disabled selected>Select Laboratory</option>
                            <option value="524">Laboratory 524</option>
                            <option value="526">Laboratory 526</option>
                            <option value="528">Laboratory 528</option>
                            <option value="530">Laboratory 530</option>
                            <option value="542">Laboratory 542</option>
                            <option value="544">Laboratory 544</option>
                            <option value="517">Laboratory 517</option>
                        </select>
                        <small class="text-muted" style="font-size: 0.9rem; margin-top: 8px; display: block;">
                            Select the laboratory for this schedule
                        </small>
                    </div>
                            <div class="form-group">
                                <label for="day" style="font-size: 1.2rem; font-weight: 600; color: #333; margin-bottom: 12px;">
                                    <i class="fas fa-calendar-day mr-2"></i> Day
                                </label>
                                <select class="form-control form-control-lg" id="day" name="day" required
                                    style="font-size: 1.1rem; padding: 12px 15px; font-weight: 500; border: 2px solid #4361ee;">
                                    <option value="" disabled selected>Select Day</option>
                                    <option value="Monday">Monday</option>
                                    <option value="Tuesday">Tuesday</option>
                                    <option value="Wednesday">Wednesday</option>
                                    <option value="Thursday">Thursday</option>
                                    <option value="Friday">Friday</option>
                                    <option value="Saturday">Saturday</option>
                                </select>
                                <small class="text-muted" style="font-size: 0.9rem; margin-top: 8px; display: block;">
                                    Select the day of the week for this schedule
                                </small>
                            </div>
                    <div class="form-group">
                        <label for="course" style="font-size: 1.2rem; font-weight: 600; color: #333; margin-bottom: 12px;">
                            <i class="fas fa-book mr-2"></i> Course
                        </label>
                        <select class="form-control form-control-lg" id="course" name="course" required
                            style="font-size: 1.1rem; padding: 12px 15px; font-weight: 500; border: 2px solid #4361ee;">
                            <option value="" disabled selected>Select Course</option>
                            <optgroup label="Programming Languages">
                                <option value="C Programming">C Programming</option>
                                <option value="C# Programming">C# Programming</option>
                                <option value="C++ Programming">C++ Programming</option>
                                <option value="Java Programming">Java Programming</option>
                                <option value="Python Programming">Python Programming</option>
                                <option value="PHP Programming">PHP Programming</option>
                                <option value=".NET Programming">.NET Programming</option>
                            </optgroup>
                            <optgroup label="Courses">
                                <option value="Digital Logic $ Design">Digital Logic & Design</option>
                                <option value="System Integration & Architecture">System Integration & Architecture</option>
                                <option value="Computer Application">Computer Application</option>
                                <option value="Project Management">Project Management</option>	
                                <option value="IT Trends">IT Trends</option>	
                                <option value="Technopreneurship">Technopreneurship</option>	
                                <option value="Capstone">Capstone</option>	
                            </optgroup>
                        </select>
                        <small class="text-muted" style="font-size: 0.9rem; margin-top: 8px; display: block;">
                            Select the course for this schedule
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="instructor" style="font-size: 1.2rem; font-weight: 600; color: #333; margin-bottom: 12px;">
                            <i class="fas fa-user-tie mr-2"></i> Instructor
                        </label>
                        <select class="form-control form-control-lg" id="instructor" name="instructor" required
                            style="font-size: 1.1rem; padding: 12px 15px; font-weight: 500; border: 2px solid #4361ee;">
                            <option value="" disabled selected>Select Instructor</option>
                            <option value="Engr. Jeff Salimbangon">Engr. Jeff Salimbangon</option>
                            <option value="Leo Bermudez">Leo Bermudez</option>
                            <option value="Jeniffer Amores">Jeniffer Amores</option>
                            <option value="Dennnis Durano">Dennnis Durano</option>
                            <option value="Franz Caminade">Franz Caminade</option>
                        </select>
                        <small class="text-muted" style="font-size: 0.9rem; margin-top: 8px; display: block;">
                            Select the instructor for this schedule
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="scheduleTime" style="font-size: 1.2rem; font-weight: 600; color: #333; margin-bottom: 12px;">
                            <i class="fas fa-clock mr-2"></i> Time
                        </label>
                        <div class="row">
                            <div class="col-md-6">
                                <label for="startTime">Start Time</label>
                                <input type="time" class="form-control form-control-lg" id="startTime" name="startTime" required
                                    style="font-size: 1.1rem; padding: 12px 15px; font-weight: 500; border: 2px solid #4361ee;">
                            </div>
                            <div class="col-md-6">
                                <label for="endTime">End Time</label>
                                <input type="time" class="form-control form-control-lg" id="endTime" name="endTime" required
                                    style="font-size: 1.1rem; padding: 12px 15px; font-weight: 500; border: 2px solid #4361ee;">
                            </div>
                        </div>
                        <small class="text-muted" style="font-size: 0.9rem; margin-top: 8px; display: block;">
                            Enter the start and end times for this schedule
                        </small>
                    </div>
                    <div class="text-right mt-4">
                        <button type="button" class="btn btn-secondary btn-lg mr-2" data-dismiss="modal" 
                            style="font-size: 1.1rem; font-weight: 600; padding: 12px 25px;">
                            <i class="fas fa-times mr-2"></i> Cancel
                        </button>
                        <button type="submit" class="btn btn-primary btn-lg" 
                            style="font-size: 1.1rem; font-weight: 600; padding: 12px 25px;">
                            <i class="fas fa-upload mr-2"></i> Upload Schedule
                        </button>
                    </div>
                </form>
            </div>
                    
                    <!-- Schedule History Tab -->
                    <div class="tab-pane fade" id="schedule-history" role="tabpanel" aria-labelledby="schedule-history-tab">
                        <div class="table-responsive">
                            <table class="table table-hover" id="scheduleHistoryTable">
                                <thead class="thead-dark">
                                    <tr>
                                        <th>Laboratory</th>
                                        <th>Day</th>
                                        <th>Course</th>
                                        <th>Instructor</th>
                                        <th>Time</th>
                                        <th>Date Added</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Schedule history will be loaded here via AJAX -->
                                </tbody>
                            </table>
                        </div>
                        <div id="scheduleHistoryEmpty" class="text-center py-5">
                            <i class="fas fa-calendar-times fa-4x mb-3 text-muted"></i>
                            <h5 class="text-muted">No lab schedules available</h5>
                            <p class="text-muted">Create your first schedule using the New Schedule tab</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Edit Schedule Modal -->
<div class="modal fade" id="editScheduleModal" tabindex="-1" role="dialog" aria-labelledby="editScheduleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #4361ee; color: white; padding: 20px;">
                <h5 class="modal-title" id="editScheduleModalLabel" style="font-size: 1.5rem; font-weight: 700;">
                    <i class="fas fa-edit mr-2"></i> Edit Lab Schedule
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color: white; opacity: 1;">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="padding: 30px;">
                <form id="editScheduleForm" action="{{ url_for('edit_lab_schedule') }}" method="POST">
                    <input type="hidden" id="edit_schedule_id" name="schedule_id">
                    <div class="form-group">
                        <label for="edit_laboratory" style="font-size: 1.2rem; font-weight: 600; color: #333; margin-bottom: 12px;">
                            <i class="fas fa-door-open mr-2"></i> Laboratory
                        </label>
                        <select class="form-control form-control-lg" id="edit_laboratory" name="laboratory" required
                            style="font-size: 1.1rem; padding: 12px 15px; font-weight: 500; border: 2px solid #4361ee;">
                            <option value="524">Laboratory 524</option>
                            <option value="526">Laboratory 526</option>
                            <option value="528">Laboratory 528</option>
                            <option value="530">Laboratory 530</option>
                            <option value="542">Laboratory 542</option>
                            <option value="544">Laboratory 544</option>
                            <option value="517">Laboratory 517</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit_day" style="font-size: 1.2rem; font-weight: 600; color: #333; margin-bottom: 12px;">
                            <i class="fas fa-calendar-day mr-2"></i> Day
                        </label>
                        <select class="form-control form-control-lg" id="edit_day" name="day" required
                            style="font-size: 1.1rem; padding: 12px 15px; font-weight: 500; border: 2px solid #4361ee;">
                            <option value="Monday">Monday</option>
                            <option value="Tuesday">Tuesday</option>
                            <option value="Wednesday">Wednesday</option>
                            <option value="Thursday">Thursday</option>
                            <option value="Friday">Friday</option>
                            <option value="Saturday">Saturday</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit_course" style="font-size: 1.2rem; font-weight: 600; color: #333; margin-bottom: 12px;">
                            <i class="fas fa-book mr-2"></i> Course
                        </label>
                        <select class="form-control form-control-lg" id="edit_course" name="course" required
                            style="font-size: 1.1rem; padding: 12px 15px; font-weight: 500; border: 2px solid #4361ee;">
                            <optgroup label="Programming Languages">
                                <option value="C Programming">C Programming</option>
                                <option value="C# Programming">C# Programming</option>
                                <option value="C++ Programming">C++ Programming</option>
                                <option value="Java Programming">Java Programming</option>
                                <option value="Python Programming">Python Programming</option>
                                <option value="PHP Programming">PHP Programming</option>
                                <option value=".NET Programming">.NET Programming</option>
                            </optgroup>
                            <optgroup label="Courses">
                                <option value="Digital Logic $ Design">Digital Logic & Design</option>
                                <option value="System Integration & Architecture">System Integration & Architecture</option>
                                <option value="Computer Application">Computer Application</option>
                                <option value="Project Management">Project Management</option>	
                                <option value="IT Trends">IT Trends</option>	
                                <option value="Technopreneurship">Technopreneurship</option>	
                                <option value="Capstone">Capstone</option>	
                            </optgroup>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit_instructor" style="font-size: 1.2rem; font-weight: 600; color: #333; margin-bottom: 12px;">
                            <i class="fas fa-user-tie mr-2"></i> Instructor
                        </label>
                        <select class="form-control form-control-lg" id="edit_instructor" name="instructor" required
                            style="font-size: 1.1rem; padding: 12px 15px; font-weight: 500; border: 2px solid #4361ee;">
                            <option value="Engr. Jeff Salimbangon">Engr. Jeff Salimbangon</option>
                            <option value="Leo Bermudez">Leo Bermudez</option>
                            <option value="Jeniffer Amores">Jeniffer Amores</option>
                            <option value="Dennnis Durano">Dennnis Durano</option>
                            <option value="Franz Caminade">Franz Caminade</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="scheduleTime" style="font-size: 1.2rem; font-weight: 600; color: #333; margin-bottom: 12px;">
                            <i class="fas fa-clock mr-2"></i> Time
                        </label>
                        <div class="row">
                            <div class="col-md-6">
                                <label for="edit_startTime">Start Time</label>
                                <input type="time" class="form-control form-control-lg" id="edit_startTime" name="startTime" required
                                    style="font-size: 1.1rem; padding: 12px 15px; font-weight: 500; border: 2px solid #4361ee;">
                            </div>
                            <div class="col-md-6">
                                <label for="edit_endTime">End Time</label>
                                <input type="time" class="form-control form-control-lg" id="edit_endTime" name="endTime" required
                                    style="font-size: 1.1rem; padding: 12px 15px; font-weight: 500; border: 2px solid #4361ee;">
                            </div>
                        </div>
                    </div>
                    <div class="text-right mt-4">
                        <button type="button" class="btn btn-secondary btn-lg mr-2" data-dismiss="modal" 
                            style="font-size: 1.1rem; font-weight: 600; padding: 12px 25px;">
                            <i class="fas fa-times mr-2"></i> Cancel
                        </button>
                        <button type="submit" class="btn btn-success btn-lg" 
                            style="font-size: 1.1rem; font-weight: 600; padding: 12px 25px;">
                            <i class="fas fa-save mr-2"></i> Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Confirm Delete Schedule Modal -->
<div class="modal fade" id="deleteScheduleModal" tabindex="-1" role="dialog" aria-labelledby="deleteScheduleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteScheduleModalLabel">
                    <i class="fas fa-trash-alt mr-2"></i> Delete Lab Schedule
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this lab schedule? This action cannot be undone.</p>
                <div id="deleteScheduleDetails" class="bg-light p-3 rounded mb-3">
                    <p class="mb-1"><strong>Laboratory:</strong> <span id="delete_laboratory"></span></p>
                    <p class="mb-1"><strong>Day:</strong> <span id="delete_day"></span></p>
                    <p class="mb-1"><strong>Course:</strong> <span id="delete_course"></span></p>
                    <p class="mb-0"><strong>Time:</strong> <span id="delete_time"></span></p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                    <i class="fas fa-times mr-2"></i> Cancel
                </button>
                <form id="deleteScheduleForm" action="{{ url_for('delete_lab_schedule') }}" method="POST">
                    <input type="hidden" id="delete_schedule_id" name="schedule_id">
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash-alt mr-2"></i> Delete Schedule
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Upload Resource/Materials Modal -->
<div class="modal fade" id="uploadResourceMaterialsModal" tabindex="-1" role="dialog" aria-labelledby="uploadResourceMaterialsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #4361ee; color: white; padding: 20px;">
                <h5 class="modal-title" id="uploadResourceMaterialsModalLabel" style="font-size: 1.5rem; font-weight: 700;">
                    <i class="fas fa-file-upload mr-2"></i> Upload Resource/Materials
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color: white; opacity: 1;">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="padding: 30px;">
                <!-- Nav tabs for resource management -->
                <ul class="nav nav-tabs" id="resourceTabs" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="upload-resource-tab" data-toggle="tab" href="#upload-resource" role="tab" aria-controls="upload-resource" aria-selected="true">New Resource</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="resource-history-tab" data-toggle="tab" href="#resource-history" role="tab" aria-controls="resource-history" aria-selected="false">Resource History</a>
                    </li>
                </ul>
                
                <div class="tab-content mt-3">
                    <!-- Upload Resource Tab -->
                    <div class="tab-pane fade show active" id="upload-resource" role="tabpanel" aria-labelledby="upload-resource-tab">
                <form id="resourceMaterialsForm" action="{{ url_for('upload_resource_materials') }}" method="POST" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="resourceTitle" style="font-size: 1.2rem; font-weight: 600; color: #333; margin-bottom: 12px;">
                            <i class="fas fa-heading mr-2"></i> Title
                        </label>
                        <input type="text" class="form-control form-control-lg" id="resourceTitle" name="resourceTitle" required
                            style="font-size: 1.1rem; padding: 12px 15px; font-weight: 500; border: 2px solid #4361ee;">
                        <small class="text-muted" style="font-size: 0.9rem; margin-top: 8px; display: block;">
                            Enter a title for this resource/material
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="resourceDescription" style="font-size: 1.2rem; font-weight: 600; color: #333; margin-bottom: 12px;">
                            <i class="fas fa-align-left mr-2"></i> Description
                        </label>
                        <textarea class="form-control form-control-lg" id="resourceDescription" name="resourceDescription" rows="3" required
                            style="font-size: 1.1rem; padding: 12px 15px; font-weight: 500; border: 2px solid #4361ee;"></textarea>
                        <small class="text-muted" style="font-size: 0.9rem; margin-top: 8px; display: block;">
                            Enter a description for this resource/material
                        </small>
                    </div>
                    <div class="form-group">
                                <label style="font-size: 1.2rem; font-weight: 600; color: #333; margin-bottom: 12px;">
                                    <i class="fas fa-link mr-2"></i> Resource Type
                                </label>
                                <div class="custom-control custom-radio custom-control-inline mb-3">
                                    <input type="radio" id="typeFile" name="resourceType" value="file" class="custom-control-input" checked>
                                    <label class="custom-control-label" for="typeFile">Upload File</label>
                                </div>
                                <div class="custom-control custom-radio custom-control-inline">
                                    <input type="radio" id="typeLink" name="resourceType" value="link" class="custom-control-input">
                                    <label class="custom-control-label" for="typeLink">Add Link</label>
                                </div>
                            </div>
                            <div class="form-group" id="fileUploadGroup">
                        <label for="resourceFile" style="font-size: 1.2rem; font-weight: 600; color: #333; margin-bottom: 12px;">
                            <i class="fas fa-file mr-2"></i> File
                        </label>
                        <div class="custom-file">
                                    <input type="file" class="custom-file-input" id="resourceFile" name="resourceFile">
                            <label class="custom-file-label" for="resourceFile" style="font-size: 1.1rem; padding: 12px 15px; font-weight: 500; border: 2px solid #4361ee;">Choose file...</label>
                        </div>
                        <small class="text-muted" style="font-size: 0.9rem; margin-top: 8px; display: block;">
                            Upload a file (PDF, DOCX, PPTX, etc.)
                        </small>
                    </div>
                            <div class="form-group" id="linkInputGroup" style="display: none;">
                                <label for="resourceLink" style="font-size: 1.2rem; font-weight: 600; color: #333; margin-bottom: 12px;">
                                    <i class="fas fa-link mr-2"></i> Google Drive Link
                                </label>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text" style="background-color: #f8f9fa; border: 2px solid #4361ee; border-right: none;">
                                            <i class="fab fa-google-drive" style="color: #4361ee;"></i>
                                        </span>
                                    </div>
                                    <input type="url" class="form-control form-control-lg" id="resourceLink" name="resourceLink"
                                        style="font-size: 1.1rem; padding: 12px 15px; font-weight: 500; border: 2px solid #4361ee;"
                                        placeholder="https://drive.google.com/file/d/...">
                                </div>
                                <small class="text-muted" style="font-size: 0.9rem; margin-top: 8px; display: block;">
                                    Paste your Google Drive sharing link here
                                </small>
                            </div>
                    <div class="text-right mt-4">
                        <button type="button" class="btn btn-secondary btn-lg mr-2" data-dismiss="modal" 
                            style="font-size: 1.1rem; font-weight: 600; padding: 12px 25px;">
                            <i class="fas fa-times mr-2"></i> Cancel
                        </button>
                        <button type="submit" class="btn btn-primary btn-lg" 
                            style="font-size: 1.1rem; font-weight: 600; padding: 12px 25px;">
                            <i class="fas fa-upload mr-2"></i> Upload Resource
                        </button>
                    </div>
                </form>
            </div>
                    
                    <!-- Resource History Tab -->
                    <div class="tab-pane fade" id="resource-history" role="tabpanel" aria-labelledby="resource-history-tab">
                        <div class="table-responsive">
                            <table class="table table-hover" id="resourceHistoryTable">
                                <thead class="thead-dark">
                                    <tr>
                                        <th>Title</th>
                                        <th>Description</th>
                                        <th>File Type</th>
                                        <th>Date Added</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Resource history will be loaded here via AJAX -->
                                </tbody>
                            </table>
                        </div>
                        <div id="resourceHistoryEmpty" class="text-center py-5">
                            <i class="fas fa-folder-open fa-4x mb-3 text-muted"></i>
                            <h5 class="text-muted">No resources available</h5>
                            <p class="text-muted">Upload your first resource using the New Resource tab</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Edit Resource Modal -->
<div class="modal fade" id="editResourceModal" tabindex="-1" role="dialog" aria-labelledby="editResourceModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #4361ee; color: white; padding: 20px;">
                <h5 class="modal-title" id="editResourceModalLabel" style="font-size: 1.5rem; font-weight: 700;">
                    <i class="fas fa-edit mr-2"></i> Edit Resource
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color: white; opacity: 1;">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="padding: 30px;">
                <form id="editResourceForm" action="#" method="POST" enctype="multipart/form-data">
                    <input type="hidden" id="edit_resource_id" name="resource_id">
                    <input type="hidden" id="edit_resource_type" name="resourceType" value="file">
                    <div class="form-group">
                        <label for="edit_resourceTitle" style="font-size: 1.2rem; font-weight: 600; color: #333; margin-bottom: 12px;">
                            <i class="fas fa-heading mr-2"></i> Title
                        </label>
                        <input type="text" class="form-control form-control-lg" id="edit_resourceTitle" name="resourceTitle" required
                            style="font-size: 1.1rem; padding: 12px 15px; font-weight: 500; border: 2px solid #4361ee;">
                    </div>
                    <div class="form-group">
                        <label for="edit_resourceDescription" style="font-size: 1.2rem; font-weight: 600; color: #333; margin-bottom: 12px;">
                            <i class="fas fa-align-left mr-2"></i> Description
                        </label>
                        <textarea class="form-control form-control-lg" id="edit_resourceDescription" name="resourceDescription" rows="3" required
                            style="font-size: 1.1rem; padding: 12px 15px; font-weight: 500; border: 2px solid #4361ee;"></textarea>
                    </div>
                    <div class="form-group" id="edit_fileUploadGroup">
                        <label for="edit_resourceFile" style="font-size: 1.2rem; font-weight: 600; color: #333; margin-bottom: 12px;">
                            <i class="fas fa-file mr-2"></i> File (Optional)
                        </label>
                        <div class="custom-file">
                            <input type="file" class="custom-file-input" id="edit_resourceFile" name="resourceFile">
                            <label class="custom-file-label" for="edit_resourceFile" style="font-size: 1.1rem; padding: 12px 15px; font-weight: 500; border: 2px solid #4361ee;">Leave empty to keep current file</label>
                        </div>
                        <small class="text-muted" style="font-size: 0.9rem; margin-top: 8px; display: block;">
                            Upload a new file only if you want to replace the current one
                        </small>
                    </div>
                    <div class="form-group" id="edit_linkInputGroup" style="display: none;">
                        <label for="edit_resourceLink" style="font-size: 1.2rem; font-weight: 600; color: #333; margin-bottom: 12px;">
                            <i class="fas fa-link mr-2"></i> Google Drive Link
                        </label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text" style="background-color: #f8f9fa; border: 2px solid #4361ee; border-right: none;">
                                    <i class="fab fa-google-drive" style="color: #4361ee;"></i>
                                </span>
                            </div>
                            <input type="url" class="form-control form-control-lg" id="edit_resourceLink" name="resourceLink"
                                style="font-size: 1.1rem; padding: 12px 15px; font-weight: 500; border: 2px solid #4361ee;"
                                placeholder="https://drive.google.com/file/d/...">
                        </div>
                        <small class="text-muted" style="font-size: 0.9rem; margin-top: 8px; display: block;">
                            Update your Google Drive sharing link
                        </small>
                    </div>
                    <div class="text-right mt-4">
                        <button type="button" class="btn btn-secondary btn-lg mr-2" data-dismiss="modal" 
                            style="font-size: 1.1rem; font-weight: 600; padding: 12px 25px;">
                            <i class="fas fa-times mr-2"></i> Cancel
                        </button>
                        <button type="submit" class="btn btn-success btn-lg" 
                            style="font-size: 1.1rem; font-weight: 600; padding: 12px 25px;">
                            <i class="fas fa-save mr-2"></i> Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Confirm Delete Resource Modal -->
<div class="modal fade" id="deleteResourceModal" tabindex="-1" role="dialog" aria-labelledby="deleteResourceModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteResourceModalLabel">
                    <i class="fas fa-trash-alt mr-2"></i> Delete Resource
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this resource? This action cannot be undone.</p>
                <div id="deleteResourceDetails" class="bg-light p-3 rounded mb-3">
                    <p class="mb-1"><strong>Title:</strong> <span id="delete_resource_title"></span></p>
                    <p class="mb-0"><strong>Description:</strong> <span id="delete_resource_description"></span></p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                    <i class="fas fa-times mr-2"></i> Cancel
                </button>
                <form id="deleteResourceForm" action="#" method="POST">
                    <input type="hidden" id="delete_resource_id" name="resource_id">
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash-alt mr-2"></i> Delete Resource
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Include this just before the closing </body> tag -->
<script>
$(document).ready(function() {
    // Display file name when selected for resource upload
    $('.custom-file-input').on('change', function() {
        var fileName = $(this).val().split('\\').pop();
        $(this).next('.custom-file-label').html(fileName);
    });
    
    // Toggle between file upload and link input based on resource type
    $('input[name="resourceType"]').on('change', function() {
        var type = $(this).val();
        if (type === 'file') {
            $('#fileUploadGroup').show();
            $('#linkInputGroup').hide();
            $('#resourceFile').prop('required', true);
            $('#resourceLink').prop('required', false);
        } else {
            $('#fileUploadGroup').hide();
            $('#linkInputGroup').show();
            $('#resourceFile').prop('required', false);
            $('#resourceLink').prop('required', true);
        }
    });
    
    // Load resource history when tab is clicked
    $('#resource-history-tab').on('click', function() {
        loadResourceHistory();
    });
    
    // Set action URLs for edit and delete forms
    $('#editResourceForm').attr('action', "{{ url_for('edit_resource') }}");
    $('#deleteResourceForm').attr('action', "{{ url_for('delete_resource') }}");
    
    // Function to load resource history
    function loadResourceHistory() {
        $.ajax({
            url: "{{ url_for('get_resources') }}",
            type: 'GET',
            dataType: 'json',
            success: function(data) {
                if (data.length > 0) {
                    $('#resourceHistoryEmpty').hide();
                    var tbody = $('#resourceHistoryTable tbody');
                    tbody.empty();
                    
                    $.each(data, function(i, resource) {
                        var row = $('<tr>');
                        
                        // Limit description length for display
                        var shortDesc = resource.description;
                        if (shortDesc.length > 50) {
                            shortDesc = shortDesc.substring(0, 50) + '...';
                        }
                        
                        // Determine file icon based on file type
                        var fileIconClass = 'fas fa-file';
                        var fileType = resource.file_path.toLowerCase();
                        
                        if (resource.resource_type === 'link') {
                            fileIconClass = 'fab fa-google-drive';
                            fileType = 'Google Drive Link';
                        } else if (fileType.endsWith('.pdf')) {
                            fileIconClass = 'fas fa-file-pdf';
                        } else if (fileType.endsWith('.doc') || fileType.endsWith('.docx')) {
                            fileIconClass = 'fas fa-file-word';
                        } else if (fileType.endsWith('.ppt') || fileType.endsWith('.pptx')) {
                            fileIconClass = 'fas fa-file-powerpoint';
                        } else if (fileType.endsWith('.xls') || fileType.endsWith('.xlsx')) {
                            fileIconClass = 'fas fa-file-excel';
                        } else if (fileType.endsWith('.zip') || fileType.endsWith('.rar')) {
                            fileIconClass = 'fas fa-file-archive';
                        } else if (fileType.endsWith('.jpg') || fileType.endsWith('.png') || fileType.endsWith('.gif')) {
                            fileIconClass = 'fas fa-file-image';
                        }
                        
                        // Build the table row
                        row.append($('<td>').text(resource.title));
                        row.append($('<td>').text(shortDesc));
                        row.append($('<td>').html('<i class="' + fileIconClass + ' mr-2"></i>' + resource.file_type));
                        row.append($('<td>').text(resource.created_at));
                        
                        // Action buttons
                        var actions = $('<td>');
                        
                        // Download button
                        var downloadBtn = $('<a>')
                            .attr('href', "{{ url_for('download_resource', resource_id=0) }}".replace('0', resource.id))
                            .attr('class', 'btn btn-sm btn-info mr-1')
                            .attr('title', 'Download')
                            .html('<i class="fas fa-download"></i>');
                        
                        // Edit button
                        var editBtn = $('<button>')
                            .attr('class', 'btn btn-sm btn-primary mr-1 edit-resource-btn')
                            .attr('data-id', resource.id)
                            .attr('data-title', resource.title)
                            .attr('data-description', resource.description)
                            .attr('data-filepath', resource.file_path)
                            .attr('data-resource-type', resource.resource_type || 'file')
                            .attr('title', 'Edit')
                            .html('<i class="fas fa-edit"></i>');
                        
                        // Delete button
                        var deleteBtn = $('<button>')
                            .attr('class', 'btn btn-sm btn-danger delete-resource-btn')
                            .attr('data-id', resource.id)
                            .attr('data-title', resource.title)
                            .attr('data-description', resource.description)
                            .attr('title', 'Delete')
                            .html('<i class="fas fa-trash-alt"></i>');
                        
                        actions.append(downloadBtn).append(editBtn).append(deleteBtn);
                        row.append(actions);
                        
                        tbody.append(row);
                    });
                } else {
                    $('#resourceHistoryEmpty').show();
                }
            },
            error: function(xhr, status, error) {
                console.error('Error loading resources:', error);
                $('#resourceHistoryEmpty').show();
            }
        });
    }
    
    // Handle edit resource button click
    $(document).on('click', '.edit-resource-btn', function() {
        var id = $(this).data('id');
        var title = $(this).data('title');
        var description = $(this).data('description');
        var resourceType = $(this).data('resource-type') || 'file';
        var filePath = $(this).data('filepath');
        
        // Populate form fields
        $('#edit_resource_id').val(id);
        $('#edit_resourceTitle').val(title);
        $('#edit_resourceDescription').val(description);
        
        // Set up appropriate edit interface based on resource type
        if (resourceType === 'link') {
            // For link resources, show link field with current URL
            $('#edit_fileUploadGroup').hide();
            $('#edit_linkInputGroup').show();
            $('#edit_resourceLink').val(filePath);
        } else {
            // For file resources, show file upload field
            $('#edit_fileUploadGroup').show();
            $('#edit_linkInputGroup').hide();
            $('.custom-file-label').text('Leave empty to keep current file');
        }
        
        // Show modal
        $('#editResourceModal').modal('show');
    });
    
    // Handle delete resource button click
    $(document).on('click', '.delete-resource-btn', function() {
        var id = $(this).data('id');
        var title = $(this).data('title');
        var description = $(this).data('description');
        
        // Populate delete confirmation
        $('#delete_resource_id').val(id);
        $('#delete_resource_title').text(title);
        $('#delete_resource_description').text(description);
        
        // Show modal
        $('#deleteResourceModal').modal('show');
    });
    
    // Reset form when modal is closed
    $('#editResourceModal').on('hidden.bs.modal', function() {
        $('#editResourceForm')[0].reset();
    });
    
    // Resource form submission
    $('#resourceMaterialsForm').submit(function() {
        // Show loading indicator or disable button if needed
        $('button[type="submit"]', this).prop('disabled', true).html('<i class="fas fa-spinner fa-spin mr-2"></i> Uploading...');
    });
    
    // Edit resource form submission
    $('#editResourceForm').submit(function() {
        $('button[type="submit"]', this).prop('disabled', true).html('<i class="fas fa-spinner fa-spin mr-2"></i> Saving...');
    });
    
    // Delete resource form submission
    $('#deleteResourceForm').submit(function() {
        $('button[type="submit"]', this).prop('disabled', true).html('<i class="fas fa-spinner fa-spin mr-2"></i> Deleting...');
    });
    });
</script>
</body>
</html>
