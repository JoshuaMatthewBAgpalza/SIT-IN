<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Students - CCS Sit-In System</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.3/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.0.1/css/buttons.bootstrap4.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}">
   <style>
    :root {
        --primary-color: #B4121B;
        --secondary-color: #8C0D14;
        --accent-color: #D43A43;
        --light-color: #f8f9fa;
        --dark-color: #000000;
        --success-color: #2bc4a9;
        --warning-color: #f9c74f;
        --danger-color: #B4121B;
    }

    body {
        font-family: Georgia, serif;
        background-color: #f5f7fa;
        color: #495057;
        min-height: 100vh;
    }

    .header-banner {
        background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
        color: white;
        padding: 16px 0;
        overflow: hidden;
    }

    .header-banner::after {
        content: '';
        position: absolute;
        bottom: -10px;
        left: 0;
        right: 0;
        height: 20px;
        background: #fff;
        border-radius: 50% 50% 0 0;
    }

    .navbar {
        background-color: #fff !important;
        box-shadow: 0 2px 15px rgba(0,0,0,0.1);
    }

    .navbar .nav-link {
        color: var(--dark-color) !important;
        font-weight: 500;
        padding: 10px 16px !important;
        border-radius: 4px;
        transition: all 0.3s ease;
    }

    .navbar .nav-link:hover {
        background-color: rgba(180, 18, 27, 0.1);
        color: var(--primary-color) !important;
    }

    .navbar .nav-item.active .nav-link {
        background-color: var(--primary-color);
        color: white !important;
    }

    .card {
        border: none;
        border-radius: 15px;
        box-shadow: 0 5px 25px rgba(0,0,0,0.05);
        transition: all 0.3s ease;
        margin-bottom: 25px;
        overflow: hidden;
        border-top: 4px solid var(--primary-color);
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(0,0,0,0.1);
    }

    .card-header {
        background: var(--dark-color);
        color: white;
        font-weight: 600;
        padding: 18px 20px;
        border-bottom: 2px solid var(--primary-color) !important;
        border-radius: 0 !important;
    }

    .card-body {
        padding: 25px;
    }

    .btn {
        border-radius: 8px;
        padding: 10px 20px;
        font-weight: 500;
        letter-spacing: 0.5px;
        transition: all 0.3s ease;
    }

    .btn-primary {
        background: var(--primary-color);
        border: none;
    }

    .btn-primary:hover {
        background: var(--secondary-color);
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(180, 18, 27, 0.3);
    }

    .btn-success {
        background: var(--success-color);
        border: none;
    }

    .btn-success:hover {
        background: #24a08c;
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(43, 196, 169, 0.3);
    }

    .btn-danger {
        background: var(--danger-color);
        border: none;
    }

    .btn-danger:hover {
        background: #8C0D14;
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(180, 18, 27, 0.3);
    }

    .btn-warning {
        background: var(--warning-color);
        border: none;
        color: #212529;
    }

    .btn-warning:hover {
        background: #e0b441;
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(249, 199, 79, 0.3);
    }

    .btn-sm {
        padding: 5px 10px;
        font-size: 0.85rem;
    }

    .table {
        background-color: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    }

    .table thead th {
        background-color: var(--dark-color);
        color: white;
        border: none;
        font-weight: 500;
        padding: 12px 15px;
        border-bottom: 2px solid var(--primary-color) !important;
    }

    .table td {
        padding: 12px 15px;
        vertical-align: middle;
        border-color: #f0f0f0;
    }

    .table tbody tr:hover {
        background-color: rgba(180, 18, 27, 0.05);
    }

    .badge {
        padding: 6px 10px;
        font-weight: 500;
        border-radius: 8px;
        color: white;
    }

    .badge-primary {
        background-color: var(--primary-color);
    }

    .badge-success {
        background-color: var(--success-color);
    }

    .badge-warning {
        background-color: var(--warning-color);
        color: #212529;
    }

    .badge-danger {
        background-color: var(--danger-color);
    }

    .badge-pill.badge-danger {
        background-color: var(--danger-color);
    }

    .modal-content {
        border-radius: 15px;
        border: none;
        overflow: hidden;
        border-top: 4px solid var(--primary-color);
    }

    .modal-header {
        background: var(--dark-color);
        color: white;
        border-bottom: 2px solid var(--primary-color);
    }

    .modal-header .close {
        color: white;
        opacity: 0.8;
    }

    .modal-header .close:hover {
        opacity: 1;
    }

    .modal-footer {
        border-top: none;
    }

    .form-control {
        border-radius: 8px;
        border: 1px solid #e1e1e1;
        padding: 12px 15px;
        font-size: 0.95rem;
        transition: all 0.3s ease;
        background-color: #f8f9fa;
        margin-bottom: 15px;
    }

    .form-control:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(180, 18, 27, 0.25);
        background-color: #fff;
    }

    /* DataTables Styling */
    .dataTables_wrapper .dataTables_length, 
    .dataTables_wrapper .dataTables_filter, 
    .dataTables_wrapper .dataTables_info, 
    .dataTables_wrapper .dataTables_processing, 
    .dataTables_wrapper .dataTables_paginate {
        color: #495057;
        margin-bottom: 15px;
    }

    .dataTables_wrapper .dataTables_length select {
        border-radius: 8px;
        border: 1px solid #e1e1e1;
        padding: 5px 8px;
    }

    .dataTables_wrapper .dataTables_filter input {
        border-radius: 8px;
        border: 1px solid #e1e1e1;
        padding: 5px 10px;
        margin-left: 5px;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button {
        padding: 5px 12px;
        margin-left: 5px;
        border-radius: 8px;
        background: #f8f9fa;
        border: 1px solid #e1e1e1;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button.current, 
    .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {
        background: var(--primary-color);
        color: white !important;
        border: 1px solid var(--primary-color);
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
        background: rgba(180, 18, 27, 0.1);
        color: var(--primary-color) !important;
    }

    .dt-buttons .btn {
        margin-right: 5px;
        margin-bottom: 10px;
    }

    /* Scrollbar styling */
    ::-webkit-scrollbar-thumb {
        background-color: var(--primary-color);
        border-radius: 10px;
    }

    /* Print styles */
    @media print {
        .card {
            border-top: 4px solid var(--primary-color) !important;
        }
        
        .header-banner {
            background: var(--primary-color) !important;
        }
        
        .table thead th {
            background-color: var(--dark-color) !important;
            color: white !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
    }
</style>
</head>

<body>
    <!-- Header Banner -->
    <div class="header-banner">
        <div class="container text-center">
            <h3 class="font-weight-bold mb-0">College of Computer Studies Admin</h3>
        </div>
    </div>

    <!-- Include Admin Navbar -->
    {% include 'admin_navbar.html' %}

    <!-- Add this after the navbar -->
    <div class="container mt-3">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    <!-- Search Modal -->
    <div class="modal fade" id="searchModal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="searchModalLabel">Search Student</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="searchInput"><i class="fas fa-id-card mr-1"></i> Student ID</label>
                        <input type="text" class="form-control" id="searchInput" placeholder="Enter student ID">
                    </div>
                    <button class="btn btn-primary" id="searchStudentBtn">
                        <i class="fas fa-search mr-1"></i> Search
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container py-5">
        {% if not single_student %}
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white d-flex align-items-center justify-content-between">
                <div>
                    <i class="fas fa-users mr-2"></i> Registered Students
                </div>
                <div>
                    <button class="btn btn-success mr-2" data-toggle="modal" data-target="#addStudentModal">
                        <i class="fas fa-user-plus mr-1"></i> Add Student
                    </button>
                    <button class="btn btn-warning" id="reset-all-sessions-btn">
                        <i class="fas fa-sync-alt mr-1"></i> Reset All Sessions
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-primary" id="csv-export">
                            <i class="fas fa-file-csv mr-1"></i> CSV
                        </button>
                        <button type="button" class="btn btn-success" id="excel-export">
                            <i class="fas fa-file-excel mr-1"></i> Excel
                        </button>
                        <button type="button" class="btn btn-danger" id="pdf-export">
                            <i class="fas fa-file-pdf mr-1"></i> PDF
                        </button>
                        <button type="button" class="btn btn-info" id="print-table">
                            <i class="fas fa-print mr-1"></i> Print
                        </button>
                    </div>
                    <div class="float-right">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text">Search:</span>
                            </div>
                            <input type="text" id="table-search" class="form-control" placeholder="Type to search...">
                        </div>
                    </div>
                </div>
                <div class="table-responsive">
                    <table id="studentsTable" class="table table-striped table-hover">
                        <thead class="bg-primary text-white">
                            <tr>
                                <th>ID Number</th>
                                <th>Username</th>
                                <th>First Name</th>
                                <th>Last Name</th>
                                <th>Course</th>
                                <th>Year Level</th>
                                <th>Remaining Sessions</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for student in students %}
                            <tr>
                                <td><a href="{{ url_for('view_student', id=student.idno) }}" class="text-primary">{{ student.idno }}</a></td>
                                <td>{{ student.username }}</td>
                                <td>{{ student.firstname }}</td>
                                <td>{{ student.lastname }}</td>
                                <td>{{ student.course }}</td>
                                <td>{{ student.year_level }}</td>
                                <td>
                                    <span class="badge {% if student.remaining_sessions <= 0 %}badge-danger{% elif student.remaining_sessions <= 5 %}badge-warning{% else %}badge-success{% endif %}">
                                        {{ student.remaining_sessions }}
                                    </span>
                                </td>
                                <td>
                                    <div class="btn-group">
                                        <button class="btn btn-primary btn-sm edit-btn mr-1" data-id="{{ student.idno }}" data-toggle="modal" data-target="#editStudentModal">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-warning btn-sm change-pass-btn mr-1" data-id="{{ student.idno }}" data-toggle="modal" data-target="#changePasswordModal">
                                            <i class="fas fa-key"></i>
                                        </button>
                                        <button class="btn btn-success btn-sm reset-session-btn mr-1" data-id="{{ student.idno }}">
                                            <i class="fas fa-sync-alt"></i>
                                        </button>
                                        <button class="btn btn-danger btn-sm delete-btn" data-id="{{ student.idno }}">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="mt-3 d-flex justify-content-between">
                    <div>Showing <span id="showing-entries">0 to 0 of 0</span> entries</div>
                    <div>
                        <nav aria-label="Table navigation">
                            <ul class="pagination justify-content-end mb-0">
                                <li class="page-item">
                                    <button class="page-link" id="prev-page">Previous</button>
                                </li>
                                <li class="page-item">
                                    <button class="page-link" id="next-page">Next</button>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Add Student Modal -->
    <div class="modal fade" id="addStudentModal" tabindex="-1" role="dialog" aria-labelledby="addStudentModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addStudentModalLabel">Add New Student</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="addStudentForm">
                        <div class="form-group">
                            <label for="idNumber"><i class="fas fa-id-card mr-1"></i> ID Number</label>
                            <input type="text" class="form-control" id="idNumber" required>
                        </div>
                        <div class="form-group">
                            <label for="username"><i class="fas fa-user mr-1"></i> Username</label>
                            <input type="text" class="form-control" id="username" required>
                        </div>
                        <div class="form-group">
                            <label for="firstName"><i class="fas fa-user-tag mr-1"></i> First Name</label>
                            <input type="text" class="form-control" id="firstName" required>
                        </div>
                        <div class="form-group">
                            <label for="lastName"><i class="fas fa-user-tag mr-1"></i> Last Name</label>
                            <input type="text" class="form-control" id="lastName" required>
                        </div>
                        <div class="form-group">
                            <label for="course"><i class="fas fa-graduation-cap mr-1"></i> Course</label>
                            <select class="form-control" id="course" required>
                                <option value="">Select Course</option>
                                <option value="BSCS">BSCS</option>
                                <option value="BSIT">BSIT</option>
                                <option value="BSEMC">BSEMC</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="yearLevel"><i class="fas fa-level-up-alt mr-1"></i> Year Level</label>
                            <select class="form-control" id="yearLevel" required>
                                <option value="">Select Year Level</option>
                                <option value="1">1st Year</option>
                                <option value="2">2nd Year</option>
                                <option value="3">3rd Year</option>
                                <option value="4">4th Year</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="password"><i class="fas fa-lock mr-1"></i> Password</label>
                            <input type="password" class="form-control" id="password" required>
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword"><i class="fas fa-lock mr-1"></i> Confirm Password</label>
                            <input type="password" class="form-control" id="confirmPassword" required>
                        </div>
                        <div class="text-right">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                <i class="fas fa-times mr-1"></i> Cancel
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save mr-1"></i> Save
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Student Modal -->
    <div class="modal fade" id="editStudentModal" tabindex="-1" role="dialog" aria-labelledby="editStudentModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editStudentModalLabel">Edit Student</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="editStudentForm">
                        <input type="hidden" id="editStudentId">
                        <div class="form-group">
                            <label for="editUsername"><i class="fas fa-user mr-1"></i> Username</label>
                            <input type="text" class="form-control" id="editUsername" required>
                        </div>
                        <div class="form-group">
                            <label for="editFirstName"><i class="fas fa-user-tag mr-1"></i> First Name</label>
                            <input type="text" class="form-control" id="editFirstName" required>
                        </div>
                        <div class="form-group">
                            <label for="editLastName"><i class="fas fa-user-tag mr-1"></i> Last Name</label>
                            <input type="text" class="form-control" id="editLastName" required>
                        </div>
                        <div class="form-group">
                            <label for="editCourse"><i class="fas fa-graduation-cap mr-1"></i> Course</label>
                            <select class="form-control" id="editCourse" required>
                                <option value="">Select Course</option>
                                <option value="BSCS">BSCS</option>
                                <option value="BSIT">BSIT</option>
                                <option value="BSEMC">BSEMC</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editYearLevel"><i class="fas fa-level-up-alt mr-1"></i> Year Level</label>
                            <select class="form-control" id="editYearLevel" required>
                                <option value="">Select Year Level</option>
                                <option value="1">1st Year</option>
                                <option value="2">2nd Year</option>
                                <option value="3">3rd Year</option>
                                <option value="4">4th Year</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editRemainingSessions"><i class="fas fa-clipboard-check mr-1"></i> Remaining Sessions</label>
                            <input type="number" class="form-control" id="editRemainingSessions" min="0" max="25" required>
                        </div>
                        <div class="text-right">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                <i class="fas fa-times mr-1"></i> Cancel
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save mr-1"></i> Update
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div class="modal fade" id="changePasswordModal" tabindex="-1" role="dialog" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="changePasswordModalLabel">Change Password</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="changePasswordForm">
                        <input type="hidden" id="passwordStudentId">
                        <div class="form-group">
                            <label for="newPassword"><i class="fas fa-lock mr-1"></i> New Password</label>
                            <input type="password" class="form-control" id="newPassword" required>
                        </div>
                        <div class="form-group">
                            <label for="confirmNewPassword"><i class="fas fa-lock mr-1"></i> Confirm New Password</label>
                            <input type="password" class="form-control" id="confirmNewPassword" required>
                        </div>
                        <div class="text-right">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                <i class="fas fa-times mr-1"></i> Cancel
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-key mr-1"></i> Change Password
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Add below the main students table card -->
    {% if single_student %}
    <div class="container py-3">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white d-flex align-items-center justify-content-between">
                <div>
                    <i class="fas fa-user-graduate mr-2"></i> Student Profile: {{ single_student.firstname }} {{ single_student.lastname }}
                </div>
                <a href="{{ url_for('view_students') }}" class="btn btn-light">
                    <i class="fas fa-arrow-left mr-1"></i> Back to All Students
                </a>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card mb-3">
                            <div class="card-header bg-secondary text-white">
                                <i class="fas fa-id-card mr-2"></i> Personal Information
                            </div>
                            <div class="card-body">
                                <table class="table table-borderless">
                                    <tr>
                                        <th style="width: 30%">ID Number:</th>
                                        <td>{{ single_student.idno }}</td>
                                    </tr>
                                    <tr>
                                        <th>Username:</th>
                                        <td>{{ single_student.username }}</td>
                                    </tr>
                                    <tr>
                                        <th>Name:</th>
                                        <td>{{ single_student.firstname }} {{ single_student.lastname }}</td>
                                    </tr>
                                    <tr>
                                        <th>Course:</th>
                                        <td>{{ single_student.course }}</td>
                                    </tr>
                                    <tr>
                                        <th>Year Level:</th>
                                        <td>{{ single_student.year_level }}</td>
                                    </tr>
                                    <tr>
                                        <th>Remaining Sessions:</th>
                                        <td>
                                            <span class="badge {% if single_student.remaining_sessions <= 0 %}badge-danger{% elif single_student.remaining_sessions <= 5 %}badge-warning{% else %}badge-success{% endif %}">
                                                {{ single_student.remaining_sessions }}
                                            </span>
                                        </td>
                                    </tr>
                                </table>
                                <div class="mt-3">
                                    <button class="btn btn-primary btn-sm edit-btn" data-id="{{ single_student.idno }}" data-toggle="modal" data-target="#editStudentModal">
                                        <i class="fas fa-edit mr-1"></i> Edit Information
                                    </button>
                                    <button class="btn btn-warning btn-sm change-pass-btn" data-id="{{ single_student.idno }}" data-toggle="modal" data-target="#changePasswordModal">
                                        <i class="fas fa-key mr-1"></i> Change Password
                                    </button>
                                    <button class="btn btn-success btn-sm reset-session-btn" data-id="{{ single_student.idno }}">
                                        <i class="fas fa-sync-alt mr-1"></i> Reset Sessions
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-info text-white">
                                <i class="fas fa-history mr-2"></i> Sit-In History
                            </div>
                            <div class="card-body">
                                {% if sit_ins %}
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover">
                                        <thead class="bg-info text-white">
                                            <tr>
                                                <th>Date</th>
                                                <th>Time In</th>
                                                <th>Time Out</th>
                                                <th>Purpose</th>
                                                <th>Lab</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for sit_in in sit_ins %}
                                            <tr>
                                                <td>{{ sit_in.login_date }}</td>
                                                <td>{{ sit_in.login_time }}</td>
                                                <td>{{ sit_in.logout_time if sit_in.logout_time else 'Active' }}</td>
                                                <td>{{ sit_in.purpose }}</td>
                                                <td>{{ sit_in.lab_number }}</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                {% else %}
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle mr-1"></i> No sit-in history found for this student.
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.3/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.0.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.0.1/js/buttons.bootstrap4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.0.1/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.0.1/js/buttons.print.min.js"></script>

    <script>
        $(document).ready(function() {
            // Initialize DataTable with simpler configuration
            var table = $('#studentsTable').DataTable({
                paging: true,
                searching: true,
                ordering: true, 
                info: true,
                lengthChange: true,
                pageLength: 10,
                language: {
                    emptyTable: "No data available in table",
                    info: "Showing _START_ to _END_ of _TOTAL_ entries",
                    infoEmpty: "Showing 0 to 0 of 0 entries"
                }
            });
            
            // Connect search input to DataTables search
            $('#table-search').on('keyup', function() {
                table.search(this.value).draw();
            });

            // CSV Export
            $('#csv-export').on('click', function() {
                window.location.href = '/export_students?format=csv';
            });
            
            // Excel Export
            $('#excel-export').on('click', function() {
                window.location.href = '/export_students?format=excel';
            });
            
            // PDF Export
            $('#pdf-export').on('click', function() {
                window.location.href = '/export_students?format=pdf';
            });
            
            // Print
            $('#print-table').on('click', function() {
                window.print();
            });

            // Add student form submission
            $('#addStudentForm').submit(function(e) {
                e.preventDefault();
                
                const idNumber = $('#idNumber').val();
                const username = $('#username').val();
                const firstName = $('#firstName').val();
                const lastName = $('#lastName').val();
                const course = $('#course').val();
                const yearLevel = $('#yearLevel').val();
                const password = $('#password').val();
                const confirmPassword = $('#confirmPassword').val();
                
                if (password !== confirmPassword) {
                    alert("Passwords don't match!");
                    return;
                }
                
                $.ajax({
                    url: '/add_student',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        idno: idNumber,
                        username: username,
                        firstname: firstName,
                        lastname: lastName,
                        course: course,
                        yearlevel: yearLevel,
                        password: password
                    }),
                    success: function(response) {
                        if (response.error) {
                            alert(response.error);
                        } else {
                            alert('Student added successfully!');
                            $('#addStudentModal').modal('hide');
                            location.reload();
                        }
                    },
                    error: function(xhr) {
                        let errorMsg = "Failed to add student.";
                        if (xhr.responseJSON && xhr.responseJSON.error) {
                            errorMsg = xhr.responseJSON.error;
                        }
                        alert(errorMsg);
                    }
                });
            });

            // Edit button click event
            $('.edit-btn').click(function() {
                const studentId = $(this).data('id');
                
                // Fetch student details
                $.ajax({
                    url: `/get_student?id=${studentId}`,
                    type: 'GET',
                    success: function(student) {
                        if (student.error) {
                            alert(student.error);
                            return;
                        }
                        
                        // Populate the edit form
                        $('#editStudentId').val(student.idno);
                        $('#editUsername').val(student.username);
                        $('#editFirstName').val(student.firstname);
                        $('#editLastName').val(student.lastname);
                        $('#editCourse').val(student.course);
                        $('#editYearLevel').val(student.yearlevel);
                        $('#editRemainingSessions').val(student.remaining_sessions);
                    },
                    error: function() {
                        alert('Error fetching student details.');
                    }
                });
            });

            // Edit student form submission
            $('#editStudentForm').submit(function(e) {
                e.preventDefault();
                
                const studentId = $('#editStudentId').val();
                const username = $('#editUsername').val();
                const firstName = $('#editFirstName').val();
                const lastName = $('#editLastName').val();
                const course = $('#editCourse').val();
                const yearLevel = $('#editYearLevel').val();
                const remainingSessions = $('#editRemainingSessions').val();
                
                $.ajax({
                    url: '/update_student',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        idno: studentId,
                        username: username,
                        firstname: firstName,
                        lastname: lastName,
                        course: course,
                        yearlevel: yearLevel,
                        remaining_sessions: remainingSessions
                    }),
                    success: function(response) {
                        if (response.error) {
                            alert(response.error);
                        } else {
                            alert('Student updated successfully!');
                            $('#editStudentModal').modal('hide');
                            location.reload();
                        }
                    },
                    error: function(xhr) {
                        let errorMsg = "Failed to update student.";
                        if (xhr.responseJSON && xhr.responseJSON.error) {
                            errorMsg = xhr.responseJSON.error;
                        }
                        alert(errorMsg);
                    }
                });
            });

            // Change password button click event
            $('.change-pass-btn').click(function() {
                const studentId = $(this).data('id');
                $('#passwordStudentId').val(studentId);
            });

            // Change password form submission
            $('#changePasswordForm').submit(function(e) {
                e.preventDefault();
                
                const studentId = $('#passwordStudentId').val();
                const newPassword = $('#newPassword').val();
                const confirmNewPassword = $('#confirmNewPassword').val();
                
                if (newPassword !== confirmNewPassword) {
                    alert("Passwords don't match!");
                    return;
                }
                
                $.ajax({
                    url: '/change_password',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        idno: studentId,
                        password: newPassword
                    }),
                    success: function(response) {
                        if (response.error) {
                            alert(response.error);
                        } else {
                            alert('Password changed successfully!');
                            $('#changePasswordModal').modal('hide');
                        }
                    },
                    error: function(xhr) {
                        let errorMsg = "Failed to change password.";
                        if (xhr.responseJSON && xhr.responseJSON.error) {
                            errorMsg = xhr.responseJSON.error;
                        }
                        alert(errorMsg);
                    }
                });
            });

            // Reset session button click event
            $('.reset-session-btn').click(function() {
                if (!confirm('Are you sure you want to reset this student\'s sessions to 30?')) {
                    return;
                }
                
                const studentId = $(this).data('id');
                
                $.ajax({
                    url: '/reset_sessions',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        idno: studentId
                    }),
                    success: function(response) {
                        if (response.error) {
                            alert(response.error);
                        } else {
                            alert('Sessions reset successfully!');
                            location.reload();
                        }
                    },
                    error: function(xhr) {
                        let errorMsg = "Failed to reset sessions.";
                        if (xhr.responseJSON && xhr.responseJSON.error) {
                            errorMsg = xhr.responseJSON.error;
                        }
                        alert(errorMsg);
                    }
                });
            });

            // Reset All Sessions button click event
            $('#reset-all-sessions-btn').click(function() {
                if (!confirm('Are you sure you want to reset ALL students\' sessions to 30? This cannot be undone.')) {
                    return;
                }
                
                $.ajax({
                    url: '/reset_all_sessions',
                    type: 'POST',
                    contentType: 'application/json',
                    success: function(response) {
                        if (response.error) {
                            alert(response.error);
                        } else {
                            alert('All student sessions have been reset successfully!');
                            location.reload();
                        }
                    },
                    error: function(xhr) {
                        let errorMsg = "Failed to reset all sessions.";
                        if (xhr.responseJSON && xhr.responseJSON.error) {
                            errorMsg = xhr.responseJSON.error;
                        }
                        alert(errorMsg);
                    }
                });
            });

            // Delete button click event
            $('.delete-btn').click(function() {
                if (!confirm('Are you sure you want to delete this student? This action cannot be undone.')) {
                    return;
                }
                
                const studentId = $(this).data('id');
                
                $.ajax({
                    url: '/delete_student',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        idno: studentId
                    }),
                    success: function(response) {
                        if (response.error) {
                            alert(response.error);
                        } else {
                            alert('Student deleted successfully!');
                            location.reload();
                        }
                    },
                    error: function(xhr) {
                        let errorMsg = "Failed to delete student.";
                        if (xhr.responseJSON && xhr.responseJSON.error) {
                            errorMsg = xhr.responseJSON.error;
                        }
                        alert(errorMsg);
                    }
                });
            });

            // Search button click handler
            $('#searchStudentBtn').click(function() {
                const studentId = $('#searchInput').val().trim();
                if (studentId === '') {
                    alert('Please enter a student ID');
                    return;
                }
                
                window.location.href = `/view_student?id=${studentId}`;
            });
        });
    </script>

    <!-- Upload Lab Schedule Modal -->
    <div class="modal fade" id="uploadLabScheduleModal" tabindex="-1" role="dialog" aria-labelledby="uploadLabScheduleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="uploadLabScheduleModalLabel">
                        <i class="fas fa-calendar-plus mr-2"></i> Upload Lab Schedule
                    </h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="labScheduleForm" action="{{ url_for('upload_lab_schedule') }}" method="POST">
                        <div class="form-group">
                            <label for="laboratory">
                                <i class="fas fa-door-open mr-2"></i> Laboratory
                            </label>
                            <select class="form-control" id="laboratory" name="laboratory" required>
                                <option value="" disabled selected>Select Laboratory</option>
                                <option value="524">Laboratory 524</option>
                                <option value="526">Laboratory 526</option>
                                <option value="528">Laboratory 528</option>
                                <option value="530">Laboratory 530</option>
                                <option value="542">Laboratory 542</option>
                                <option value="544">Laboratory 544</option>
                                <option value="517">Laboratory 517</option>
                            </select>
                            <small class="text-muted">Select the laboratory for this schedule</small>
                        </div>
                        <div class="form-group">
                            <label for="course">
                                <i class="fas fa-book mr-2"></i> Course
                            </label>
                            <select class="form-control" id="course" name="course" required>
                                <option value="" disabled selected>Select Course</option>
                                <optgroup label="Programming Languages">
                                    <option value="C Programming">C Programming</option>
                                    <option value="C# Programming">C# Programming</option>
                                    <option value="C++ Programming">C++ Programming</option>
                                    <option value="Java Programming">Java Programming</option>
                                    <option value="Python Programming">Python Programming</option>
                                    <option value="PHP Programming">PHP Programming</option>
                                    <option value=".NET Programming">.NET Programming</option>
                                </optgroup>
                                <optgroup label="Courses">
                                    <option value="Digital Logic $ Design">Digital Logic & Design</option>
                                    <option value="System Integration & Architecture">System Integration & Architecture</option>
                                    <option value="Computer Application">Computer Application</option>
                                    <option value="Project Management">Project Management</option>	
                                    <option value="IT Trends">IT Trends</option>	
                                    <option value="Technopreneurship">Technopreneurship</option>	
                                    <option value="Capstone">Capstone</option>	
                                </optgroup>
                            </select>
                            <small class="text-muted">Select the course for this schedule</small>
                        </div>
                        <div class="form-group">
                            <label for="instructor">
                                <i class="fas fa-user-tie mr-2"></i> Instructor
                            </label>
                            <select class="form-control" id="instructor" name="instructor" required>
                                <option value="" disabled selected>Select Instructor</option>
                                <option value="Engr. Jeff Salimbangon">Engr. Jeff Salimbangon</option>
                                <option value="Leo Bermudez">Leo Bermudez</option>
                                <option value="Jeniffer Amores">Jeniffer Amores</option>
                                <option value="Dennnis Durano">Dennnis Durano</option>
                                <option value="Franz Caminade">Franz Caminade</option>
                            </select>
                            <small class="text-muted">Select the instructor for this schedule</small>
                        </div>
                        <div class="form-group">
                            <label>
                                <i class="fas fa-clock mr-2"></i> Time
                            </label>
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="startTime">Start Time</label>
                                    <input type="time" class="form-control" id="startTime" name="startTime" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="endTime">End Time</label>
                                    <input type="time" class="form-control" id="endTime" name="endTime" required>
                                </div>
                            </div>
                            <small class="text-muted">Enter the start and end times for this schedule</small>
                        </div>
                        <div class="text-right mt-4">
                            <button type="button" class="btn btn-secondary mr-2" data-dismiss="modal">
                                <i class="fas fa-times mr-2"></i> Cancel
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-upload mr-2"></i> Upload Schedule
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Resource/Materials Modal -->
    <div class="modal fade" id="uploadResourceMaterialsModal" tabindex="-1" role="dialog" aria-labelledby="uploadResourceMaterialsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="uploadResourceMaterialsModalLabel">
                        <i class="fas fa-file-upload mr-2"></i> Upload Resource/Materials
                    </h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="resourceMaterialsForm" action="{{ url_for('upload_resource_materials') }}" method="POST" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="resourceTitle">
                                <i class="fas fa-heading mr-2"></i> Title
                            </label>
                            <input type="text" class="form-control" id="resourceTitle" name="resourceTitle" required>
                            <small class="text-muted">Enter a title for this resource/material</small>
                        </div>
                        <div class="form-group">
                            <label for="resourceDescription">
                                <i class="fas fa-align-left mr-2"></i> Description
                            </label>
                            <textarea class="form-control" id="resourceDescription" name="resourceDescription" rows="3" required></textarea>
                            <small class="text-muted">Enter a description for this resource/material</small>
                        </div>
                        <div class="form-group">
                            <label for="resourceFile">
                                <i class="fas fa-file mr-2"></i> File
                            </label>
                            <div class="custom-file">
                                <input type="file" class="custom-file-input" id="resourceFile" name="resourceFile" required>
                                <label class="custom-file-label" for="resourceFile">Choose file...</label>
                            </div>
                            <small class="text-muted">Upload a file (PDF, DOCX, PPTX, etc.)</small>
                        </div>
                        <div class="text-right mt-4">
                            <button type="button" class="btn btn-secondary mr-2" data-dismiss="modal">
                                <i class="fas fa-times mr-2"></i> Cancel
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-upload mr-2"></i> Upload Resource
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Display file name when selected for resource upload
        $('.custom-file-input').on('change', function() {
            let fileName = $(this).val().split('\\').pop();
            $(this).next('.custom-file-label').html(fileName);
        });
    </script>
</body>
</html> 